Actor DoFlameBelch : Inventory {Inventory.MaxAmount 1}
Actor DoIceBomb : Inventory {Inventory.MaxAmount 1}

Actor CoolFlameBelch : Inventory {Inventory.MaxAmount 60}
Actor CoolIceBomb : Inventory {Inventory.MaxAmount 60}

Actor FlameBelchReady : Inventory {Inventory.MaxAmount 1}
Actor IceBombReady : Inventory {Inventory.MaxAmount 1}
Actor DoShoulderCannon : Inventory {Inventory.MaxAmount 1}

Actor SC_CryoGrenade : PB_FragGrenade
{
   +NODAMAGETHRUST
   +FORCEXYBILLBOARD
   +FORCERADIUSDMG
   +BLOODLESSIMPACT
	Damage 0
	DamageType "Freeze"
	RenderStyle Add
	Alpha 0.95
	BounceFactor 0.15
	DeathSound "weapons/CryoRifle/freezeobject"
	Decal "FreezerBurn"
	States
	{
	Spawn:
	   TNT1 A 0 {
			If(WaterLevel > 1) {A_SpawnItem ("CryoRifleTrailSparksSmall"); }
			A_SpawnItem("BlueFlareSmall",0,0);
			}
	   GRNP A 1 Bright Light("SGL_CRYO")
	   Loop

	Bounce:
	   TNT1 A 0
	   TNT1 A 0 {
			If(GetCvar("pb_sglgrenadeimpact") == 1)
			{ 
			Return State("Death");
			}
			Else If(GetCvar("pb_sglgrenadeimpact") >=2)
			{
			A_Stop;
			Return State("Rest");
			}
			Return State("");
			}
	   Goto Spawn
	Rest:
	   GRNP A 35 Bright Light("SGL_CRYO")
	DetonateGKCryoGrenade:
	   TNT1 A 0
	   TNT1 A 0 A_Scream
	Death:
	XDeath:
	   TNT1 A 0
	   TNT1 A 0 Bright A_StopSound(CHAN_BODY)
	   TNT1 A 0 Bright A_ChangeFlag("ICEDAMAGE", 1)
	   TNT1 A 0 Bright A_ChangeFlag("NODAMAGETHRUST", 0)
	   TNT1 A 0 Bright A_Explode(150,200, 0)  
	   TNT1 A 0 Bright A_Explode(120, 300, 0)
	   TNT1 A 0 A_CheckFloor("GKCryoGrenadeDeathFloor")
	   TNT1 A 0 A_CheckCeiling("GKCryoGrenadeDeathCeiling")
	   Goto GKCryoGrenadeDeathEffects
	GKCryoGrenadeDeathFloor:
	   TNT1 AAAAAAAAAAAAA 0 A_SpawnItemEx("GKDetectFloorIce",Random(-150,150), Random(-150,150),1,0,0,0,0,SXF_NOCHECKPOSITION,0)
	   Goto GKCryoGrenadeDeathEffects
	GKCryoGrenadeDeathCeiling:
	   TNT1 AAAA 0 A_SpawnItemEx("GKDetectCeilIce",Random(-30,30), Random(-30,30),1,0,0,0,0,SXF_NOCHECKPOSITION,0)
	   Goto GKCryoGrenadeDeathEffects
	GKCryoGrenadeDeathEffects:
	   TNT1 AAAAAAAAAAAAAA 0 Bright A_SpawnItemEx("CryoSmoke", 0, 0, 0, Random(10, 30)*0.2, 0, Random(0, 10)*0.2, Random(1,360), SXF_CLIENTSIDE|SXF_NOCHECKPOSITION)
	   TNT1 AAAAAAA 0 Bright A_SpawnItemEx("CryoSmoke3", 0, 0, 0, Random(10, 30)*0.08, 0, Random(0, 10)*0.08, Random(1,360), SXF_CLIENTSIDE|SXF_NOCHECKPOSITION,64)
	   TNT1 AAAAAAAAAAAA 0 Bright A_SpawnItemEx("CryoRifleTrailSparksSmall", Random(5,-5), Random(5,-5), Random(5,-5), Random(10, 30)*0.04, 0, Random(0, 10)*0.04, Random(1,360), SXF_CLIENTSIDE|SXF_NOCHECKPOSITION,64)
	   TNT1 AAAAAAA 0 Bright A_SpawnItemEx("CryoSmoke2", 0, 0, 0, Random(10, 30)*0.08, 0, Random(0, 10)*0.08, Random(1,360), SXF_CLIENTSIDE|SXF_NOCHECKPOSITION,64)
	   TNT1 AAAAAAAAAAA 0 Bright A_SpawnItemEx("IceExplosionImpact", Random(-4,4), Random(-4,4), Random(-4,4), 0, 0, 0, Random(1,360), SXF_CLIENTSIDE|SXF_NOCHECKPOSITION)
	   TNT1 A 0 A_PlaySound("weapons/CryoRifle/missiledeath")
	   TNT1 AAA 0 Bright A_SpawnItemEx("GKDetectFloorCraterIce",0,0,1,0,0,0,0,SXF_NOCHECKPOSITION,0)
	   TNT1 AAA 0 Bright A_SpawnItemEx("GKDetectCeilCraterIce",0,0,1,0,0,0,0,SXF_NOCHECKPOSITION,0)
	   Stop
	}
}

Actor SCFireMissile : FlamethrowerMissileNew
{
	Game Doom
	Radius 2
	Height 2
	Speed 25
	Damage 1
    +NOBLOCKMAP
    +NOTELEPORT
    +DONTSPLASH
	+MISSILE
	+FORCEXYBILLBOARD
	-RIPPER
	+NOBLOOD
	+NOBLOODDECALS
	+BLOODLESSIMPACT
	-BLOODSPLATTER
	+FORCEPAIN
	RenderStyle Add
    DamageType GloryFire
    Scale 0.65
	DeathSound "FlameBelch/FlameCrackle"
	States
	{
    Spawn:
	    TNT1 A 0
		FIR5 ABC 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
        FIR3 A 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
		EXPL A 0 A_CustomMissile ("SmallFireTrail", 6, 0, 0, 2, Random (0, 10))
		DB54 D 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
		EXPL A 0 A_CustomMissile ("SmallFireTrail", 6, 0, 0, 2, Random (0, 20))
		TNT1 A 0 A_Explode(3, 100, 0)
		EXPL A 0 A_CustomMissile ("SmallFireTrail", 6, 0, 0, 2, Random (0, 30))
		DB54 E 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
		EXPL A 0 A_CustomMissile ("SmallFireTrail", 6, 0, 0, 2, Random (0, 40))
		DB54 F 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
		EXPL A 0 A_CustomMissile ("SmallFireTrail", 6, 0, 0, 2, Random (0, 50))
		DB54 G 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
		TNT1 A 0 A_Explode(3, 100, 0)
		EXPL A 0 A_CustomMissile ("SmallFireTrail", 6, 0, 0, 2, Random (-10, 60))
		DB54 H 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
		EXPL A 0 A_CustomMissile ("SmallFireTrail", 6, 0, 0, 2, Random (-50, 70))
		DB54 I 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
		EXPL A 0 A_CustomMissile ("SmallFireTrail", 6, 0, 0, 2, Random (-60, 80))
		DB54 J 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
		TNT1 A 0 A_Explode(3, 100, 0)
		DB54 KL 1 Bright A_SpawnItem("RedFlare", 0, 0)
		TNT1 A 0 A_Explode(3, 150, 0)
		TNT1 A 0 A_PlaySound("FlameBelch/FlameCrackle")
	}
}

Actor SCFireMissileSimple
{
	Game Doom
	Radius 2
	Height 2
	Speed 25
	Damage 1
    +NOBLOCKMAP
    +NOTELEPORT
    +DONTSPLASH
	+MISSILE
	+FORCEXYBILLBOARD
	-RIPPER
	+NOBLOOD
	+NOBLOODDECALS
	+BLOODLESSIMPACT
	-BLOODSPLATTER
	+FORCEPAIN
	RenderStyle Add
    DamageType GloryFire
    Scale 0.65
	Alpha 1.0
	Gravity 0
	DeathSound "FlameBelch/FlameCrackle"
	States
	{
    Spawn:
	    TNT1 A 0
		FIR5 ABC 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
        FIR3 A 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
		EXPL A 0 A_CustomMissile ("SmallFireTrail", 6, 0, 0, 2, Random (0, 10))
		DB54 D 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
		EXPL A 0 A_CustomMissile ("SmallFireTrail", 6, 0, 0, 2, Random (0, 20))
		TNT1 A 0 A_Explode(3, 100, 0)
		EXPL A 0 A_CustomMissile ("SmallFireTrail", 6, 0, 0, 2, Random (0, 30))
		DB54 E 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
		EXPL A 0 A_CustomMissile ("SmallFireTrail", 6, 0, 0, 2, Random (0, 40))
		DB54 F 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
		EXPL A 0 A_CustomMissile ("SmallFireTrail", 6, 0, 0, 2, Random (0, 50))
		DB54 G 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
		TNT1 A 0 A_Explode(3, 100, 0)
		EXPL A 0 A_CustomMissile ("SmallFireTrail", 6, 0, 0, 2, Random (-10, 60))
		DB54 H 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
		EXPL A 0 A_CustomMissile ("SmallFireTrail", 6, 0, 0, 2, Random (-50, 70))
		DB54 I 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
		EXPL A 0 A_CustomMissile ("SmallFireTrail", 6, 0, 0, 2, Random (-60, 80))
		DB54 J 1 Bright A_SpawnItem("RedFlareSmall", 0, 0)
		TNT1 A 0 A_Explode(3, 100, 0)
		EXPL A 0 A_CustomMissile ("FBFireParticles", 6, 0, 0, 2, Random (10, 20))
		DB54 KL 1 Bright A_SpawnItem("RedFlare", 0, 0)
		TNT1 A 0 A_Explode(3, 150, 0)
		EXPL A 0 A_CustomMissile ("FBFireParticles", 6, 0, Random (0, 360), 2, Random (10, 90))
		Stop
	Death:
	    TNT1 A 0 A_Explode(35, 150, 0)
	    TNT1 A 0 A_Explode(3, 50)
	    TNT1 A 0 {
		     A_SpawnItemEx("FBTinyBurningPiece2", Random (-25, 25), Random (-15, 15));
	         A_SpawnItemEx("FBTinyBurningPiece", Random (-15, 15), Random (-15, 15));
	         A_CustomMissile ("FBFireParticles", 6, 0, Random (0, 360), 2, Random (10, 90));
			 A_PlaySound("FlameBelch/FlameCrackle");
			 }
		TNT1 A 0
	    Stop
   }
}

Actor FBFireParticles
{
	Game Doom
	Radius 1
	Height 1
	Speed 2
	Damage 0 
    +NOBLOCKMAP
    +NOTELEPORT
    +DONTSPLASH
	+MISSILE
    +CLIENTSIDEONLY
    +NOINTERACTION
	+NOCLIP
	+FORCEXYBILLBOARD
	DamageType GloryFire
	Renderstyle Add
    Scale 1.25
	Alpha 1.0
	Gravity 0
	States
	{
    Spawn:
	    TNT1 A 0
        DB54 ABCD 2 Bright A_SpawnItem("RedFlare", 0, 10)
		TNT1 A 0 A_CustomMissile ("BigBlackSmoke", 40, 0, Random (0, 360), 2, Random (40, 160))
		DB54 EFGHIJKLMNO 2 Bright A_SpawnItem("RedFlare", 0, 10)
		TNT1 A 0 A_SpawnItemEx("BurningEmberParticlesFloating_Bigger_Faster", Random(16,-16), Random(16,-16), Random(16,-16), 0, 0, 0, 0, 128, 0)
		DB54 PQR 2 Bright
	    Stop
	}
}

Actor FBTinyBurningPiece: TinyBurningPiece {DamageType GloryFire}
Actor FBTinyBurningPiece2: TinyBurningPiece2 {DamageType GloryFire}

Actor GKDetectFloorIce
{
    Game Doom
    Scale 5.0
    Speed 0
    Health 1
    Radius 8
    Height 2
    Gravity 0.9
    Renderstyle Add
    Alpha 0.9
    Damage 0
	DamageType Blood
   +MISSILE
   +CLIENTSIDEONLY
   +NOTELEPORT
   +NOBLOCKMAP
   +FORCEXYBILLBOARD
   +NODAMAGETHRUST
   +MOVEWITHSECTOR
   -DONTSPLASH
   +DOOMBOUNCE
    BounceFactor 0.01
	States
    {
    Spawn:
	    TNT1 A 0
	    TNT1 A 5
	    Stop
    Death:
	    TNT1 A 0 Bright A_SpawnItemEx("IcicleGround", Random(-140,140), Random(-140,140), 0, 0, 0, 0, 0, SXF_CLIENTSIDE|SXF_NOCHECKPOSITION)
		TNT1 A 0 Bright A_SpawnItemEx("IcicleGround", Random(-140,140), Random(-140,140), 0, 0, 0, 0, 0, SXF_CLIENTSIDE|SXF_NOCHECKPOSITION)
	    XXX1 A 530
	    XXX1 AAAAAAAAAAAAAAAAAAAA 1 A_FadeOut(0.05)
        Stop
    }
}

Actor GKDetectCeilIce
{
    Game Doom
    Scale 5.0
    Speed 0
    Health 1
    Radius 1
    Height 2
    Gravity 0.0
    Damage 0
    Renderstyle Add
    Alpha 0.9
    DamageType Blood
   +MISSILE
   +CLIENTSIDEONLY
   +NOTELEPORT
   +NOBLOCKMAP
   +FORCEXYBILLBOARD
   +NODAMAGETHRUST
   -DONTSPLASH
   +NOGRAVITY
    States
    {
    Spawn:
	   TNT1 A 0
	   TNT1 A 0 ThrustThingZ(0,35,0,1)
	   TNT1 A 1
	   Stop
	Death:
	   TNT1 AAA 0 Bright A_SpawnItemEx("IcicleCeiling",Random(-10,10), Random(-10,10), 0, 0, 0, 0, 0, SXF_CLIENTSIDE|SXF_NOCHECKPOSITION)
	   TNT1 A 0 A_SpawnItemEx("CeilingCrystal1", Random(-60,60), Random(-60,60), -1, 0, 0, 0, 0, SXF_CLIENTSIDE|SXF_NOCHECKPOSITION)
	   TNT1 A 0 A_SpawnItemEx("CeilingCrystal2", Random(-60,60), Random(-60,60), -1, 0, 0, 0, 0, SXF_CLIENTSIDE|SXF_NOCHECKPOSITION)
	   TNT1 A 0 A_SpawnItemEx("CeilingCrystal3", Random(-60,60), Random(-60,60), -1, 0, 0, 0, 0, SXF_CLIENTSIDE|SXF_NOCHECKPOSITION)
	   TNT1 A 0 A_SpawnItemEx("CeilingCrystal4", Random(-60,20), Random(-60,20), -1, 0, 0, 0, 0, SXF_CLIENTSIDE|SXF_NOCHECKPOSITION)
	   XXX1 A 530 Bright
	   XXX1 AAAAA 1 A_FadeOut(0.05)
      Stop
    }
}

Actor GKDetectFloorCraterIce
{
    Game Doom
    Scale 3.4
    Speed 0
    Health 1
    Radius 8
    Height 4
    Gravity 0.9
    Damage 0
    Renderstyle Shaded
    StencilColor "Black"
    Alpha 0.9
	DamageType Blood
   +MISSILE
   +CLIENTSIDEONLY
   +NOTELEPORT
   +NOBLOCKMAP
   +FORCEXYBILLBOARD
   +NODAMAGETHRUST
   +MOVEWITHSECTOR
   -DONTSPLASH
   +DOOMBOUNCE
    BounceFactor 0.01
    States
    {
    Spawn:
	   TNT1 A 0
	   TNT1 A 2
	   Goto Spawn2
	Spawn2:
	   TNT1 A 0 ThrustThingZ(0,-10,0,1)
	   TNT1 A 4
	   Stop
	Death:
	   TNT1 A 1
	   XXX1 A 2000
       Stop
    }
}

Actor GKDetectCeilCraterIce
{
    Game Doom
    Scale 3.4
    Speed 0
    Health 1
    Radius 1
    Height 1
    Gravity 0.0
    Damage 0
    Renderstyle Shaded
    StencilColor "Black"
    Alpha 0.9
	DamageType Blood
   +MISSILE
   +CLIENTSIDEONLY
   +NOTELEPORT
   +NOBLOCKMAP
   -FORCEXYBILLBOARD
   +NODAMAGETHRUST
   -DONTSPLASH
   +NOGRAVITY
    States
    {
    Spawn:
	   TNT1 A 0
	   TNT1 A 0 ThrustThingZ(0,35,0,1)
	   TNT1 A 2
	   Stop
	 Death:
	   XXX1 A 2000
	   XXX1 AAAAA 1 A_FadeOut(0.05)
       Stop
    }
}

Actor FireArmorPinata : ArmorPinata
{
	scale 0.4
	Armor.Saveamount 1
}

Actor FireArmorPinataL1 : ArmorPinataL1
{
	Armor.Saveamount 2
}

Actor FlamePinataSpawn
{
	States
	{
		Spawn:
			TNT1 AA 0 A_SpawnItemEx("FireArmorPinata",0,0,16,Random(0,8),0,Random(0,8),Random(0,360))
			Stop
	}
}

Actor FlamePinataSpawnHigh
{
	States
	{
		Spawn:
			TNT1 A 0 A_Jump(127, "SpawnHigh")
			TNT1 AA 0 A_SpawnItemEx("FireArmorPinata",0,0,16,Random(0,8),0,Random(0,8),Random(0,360))
			Stop
			
		SpawnHigh:
			TNT1 AA 0 A_SpawnItemEx("FireArmorPinataL1",0,0,16,Random(0,8),0,Random(0,8),Random(0,360))
			Stop	
	}
}